---
interface Props {
  title: string;
  href?: string;
  icon?: string;
  isExpanded?: boolean;
  isStatic?: boolean;
}

const { title, href, icon, isExpanded = false, isStatic = false } = Astro.props;
const hasChildren = await Astro.slots.has('default');
---

<div class="nav-section" data-section={title.toLowerCase()}>
  <button
    type="button"
    class="nav-toggle w-full flex items-center justify-between px-2 py-1.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors"
    data-section={title.toLowerCase()}
    aria-expanded={isExpanded ? "true" : "false"}
  >
    <span class="flex items-center gap-2">
      {icon && (
        <Fragment set:html={icon} />
      )}
      {href ? (
        <a href={href} class="hover:text-gray-900 dark:hover:text-white" onclick="event.stopPropagation()">
          {title}
        </a>
      ) : (
        <span>{title}</span>
      )}
    </span>
    {hasChildren && (
      <svg
        class="chevron w-4 h-4 transition-transform"
        class:list={[isExpanded ? 'rotate-90' : '']}
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    )}
  </button>

  {hasChildren && (
    <div class="nav-content pl-3" class:list={[isExpanded ? '' : 'hidden']}>
      <slot />
    </div>
  )}
</div>

<script>
  document.querySelectorAll('.nav-toggle').forEach(button => {
    button.addEventListener('click', () => {
      const section = button.getAttribute('data-section');
      const content = button.parentElement?.querySelector('.nav-content');
      const chevron = button.querySelector('.chevron');
      const isExpanded = button.getAttribute('aria-expanded') === 'true';

      if (content && chevron) {
        if (isExpanded) {
          content.classList.add('hidden');
          chevron.classList.remove('rotate-90');
          button.setAttribute('aria-expanded', 'false');
          if (section) localStorage.setItem(`nav-${section}`, 'collapsed');
        } else {
          content.classList.remove('hidden');
          chevron.classList.add('rotate-90');
          button.setAttribute('aria-expanded', 'true');
          if (section) localStorage.setItem(`nav-${section}`, 'expanded');
        }
      }
    });

    // Restore state from localStorage
    const section = button.getAttribute('data-section');
    if (section) {
      const savedState = localStorage.getItem(`nav-${section}`);
      if (savedState === 'collapsed') {
        const content = button.parentElement?.querySelector('.nav-content');
        const chevron = button.querySelector('.chevron');
        if (content && chevron) {
          content.classList.add('hidden');
          chevron.classList.remove('rotate-90');
          button.setAttribute('aria-expanded', 'false');
        }
      }
    }
  });
</script>
